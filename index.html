// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract XTokenV2 is ERC20, Ownable {
    uint256 public constant maxSupply = 350000 * 1e18;
    uint256 public mintBatchSize = 24000 * 1e18;
    uint256 public maxDailyMint = 350000 * 1e18;

    uint256 public mintedToday;
    uint256 public lastMintDayStart;

    // Hardcoded mint recipient: AUTO-XTK-001
    address public constant mintReceiver = address(0x7a523a378e047C4c4744c1BA128BB0B8D9915b83);

    constructor() ERC20("XTokenV2", "XTK2") Ownable(msg.sender) {}

    modifier withinDailyLimit() {
        if (block.timestamp >= lastMintDayStart + 1 days) {
            mintedToday = 0;
            lastMintDayStart = block.timestamp;
        }
        require(mintedToday + mintBatchSize <= maxDailyMint, "Daily mint limit exceeded");
        _;
    }

    modifier canMint() {
        require(totalSupply() + mintBatchSize <= maxSupply, "Max supply reached");
        _;
    }

    function mint() external onlyOwner withinDailyLimit canMint {
        _mint(mintReceiver, mintBatchSize);
        mintedToday += mintBatchSize;
    }

    function updateMintBatchSize(uint256 newBatch) external onlyOwner {
        require(newBatch <= maxSupply, "Batch too large");
        mintBatchSize = newBatch;
    }

    function updateMaxDailyMint(uint256 newDailyMax) external onlyOwner {
        require(newDailyMax <= maxSupply, "Exceeds cap");
        maxDailyMint = newDailyMax;
    }

    function getDailyMintInfo() external view returns (uint256 minted, uint256 remaining, uint256 resetAt) {
        uint256 resetTime = lastMintDayStart + 1 days;
        uint256 rem = maxDailyMint > mintedToday ? maxDailyMint - mintedToday : 0;
        return (mintedToday, rem, resetTime);
    }
}
